var url="http://ec2-52-5-117-32.compute-1.amazonaws.com/unicef/public",saveActivity="/api/app-activity",method="POST",userNamePassword="unicef-api:Un!cef-P@ssw0rd",xhr=new XMLHttpRequest,data=new datamodel,database_uuid=getUUID();function getUUID(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)})}function getFullDate(){var e=new Date;return addZero(e.getFullYear(),4)+"-"+addZero(e.getMonth()+1,2)+"-"+addZero(e.getDate(),2)+" "+addZero(e.getHours(),2)+":"+addZero(e.getMinutes(),2)+":"+addZero(e.getSeconds(),2)+":"+addZero(e.getMilliseconds(),3)}function addZero(e,t){for(;e.toString().length<t;)e="0"+e;return e}function addScoreData(e){let t=new questiondata;t.GL_LEVEL_ID=e.lId,t.GL_LEVEL_NAME=e.lName,t.GL_LEVEL_KNOWLEDGE_DOMAIN=e.lKnowledgeDom,t.GL_LEVEL_TYPE=e.lType,t.GL_LEVEL_INTERACTIVITY=e.lInteractivity,t.GL_QUESTION_ID=e.qId,t.LL_QUESTION_TYPE=e.qType,t.GL_QUESTION_ACTION_VERB=e.qActionVerb,t.GL_LEVEL_COGNITIVE_DOMAIN=e.cognitiveDom,t.GL_QUESTION_COGNITIVE=e.cognitiveDom,t.TR_USER_SCORE="".concat(e.uScore),t.GL_MODULE_ID=app_module_id,t.GL_MODULE_NAME=app_module_name,t.ATTEMPTED_ON=getFullDate(),t.HOST_IP=app_server_ip,t.DEVICE_BROWSER_VERSION=get_browser().name.concat(" ").concat(get_browser().version),t.DEVICE_PLATFORM=app_device_platform,t.USER_OID=app_unicef_user_id,data.data.push(t),console.log("Entry Added ",t)}function saveScoreToLocalDB(){let e=JSON.stringify(data);data=new datamodel,localStorage.setItem("UserScoreData",""),localStorage.setItem("UserScoreData",e),null!=app_unicef_user_id&&setTimeout(sendDataToServer,1e3)}function sendDataToServer(){xhr.open(method,url.concat(saveActivity),!0),xhr.setRequestHeader("Authorization","Basic "+btoa(userNamePassword)),xhr.setRequestHeader("Content-type","application/json");let e=localStorage.getItem("UserScoreData");xhr.send(e)}function clearLocalDbData(){localStorage.setItem("UserScoreData","")}function datamodel(){this.data=[]}function questiondata(){this.USER_OID="mango",this.GL_MODULE_ID="SSD",this.GL_MODULE_NAME="Disability Statistics",this.GL_LEVEL_ID=1,this.GL_LEVEL_NAME="L1",this.GL_LEVEL_KNOWLEDGE_DOMAIN="Seeing",this.GL_LEVEL_COGNITIVE_DOMAIN="CFM-7",this.GL_LEVEL_TYPE="T1",this.GL_LEVEL_INTERACTIVITY="GL_l1",this.GL_QUESTION_ID="1",this.GL_QUESTION_COGNITIVE="dsgdsgsdg",this.GL_QUESTION_ACTION_VERB="sdgdgdfg",this.LL_QUESTION_TYPE="QT1",this.TR_USER_SCORE="1",this.HOST_IP="",this.DEVICE_BROWSER_VERSION="",this.DEVICE_MODEL="NA",this.DEVICE_KERNEL_VERSION="NA",this.DEVICE_SERIAL_NUMBER="NA",this.DEVICE_PLATFORM="",this.ATTEMPTED_ON=""}function get_browser(){var e,t=navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(a[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===a[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),{name:a[0],version:a[1]})}xhr.onload=function(){(xhr.readyState=200==xhr.status)&&(console.log("Data send seccussfull"),clearLocalDbData())},xhr.onerror=function(e){console.log("Error in sending data ",xhr.status)};var xhrIpRequest=new XMLHttpRequest;function GetIpAddResss(){xhrIpRequest.open("GET","https://api.ipify.org",!0),xhrIpRequest.setRequestHeader("Content-type","application/json"),xhrIpRequest.send()}xhrIpRequest.onload=function(){(xhrIpRequest.readyState=200==xhrIpRequest.status)&&(console.log("IP ",xhrIpRequest.responseText),app_server_ip=xhrIpRequest.responseText)},xhrIpRequest.onerror=function(e){console.log("IP error ",xhrIpRequest.status)},GetIpAddResss();
